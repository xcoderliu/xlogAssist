# xlogAssist 模块化说明

## 项目结构

```
xlogAssist/
├── core.js                     # 核心模块 - 主控制器
├── fileHandler.js              # 文件处理模块
├── searchFilter.js             # 搜索过滤模块
├── configManager.js            # 配置管理模块
├── uiRenderer.js               # UI渲染模块
├── contextMenu.js              # 右键菜单模块
├── investigation.js            # 排查区模块
├── diagnosis.js                # 问题诊断模块
├── export.js                   # 导出模块
├── resizer.js                  # 分隔条模块
├── customDownloadManager.js    # 自定义下载管理模块
├── utils.js                    # 工具函数模块
├── main.js                     # 主入口文件
├── index.html                  # 主页面
├── server.js                   # 后端服务器
├── package.json                # 项目配置
└── customDownLoadLogSources/   # 自定义下载源目录
    └── SensorLog/              # 示例自定义下载源
        └── index.html          # 自定义下载页面
```

## 模块功能说明

### 1. core.js - 核心模块
- **职责**: 主控制器，协调各模块
- **功能**:
  - 初始化所有模块
  - 管理应用状态和数据
  - 绑定事件处理
  - 配置持久化
  - 状态管理
  - 标签页切换管理

### 2. fileHandler.js - 文件处理模块
- **职责**: 文件上传、读取、解析
- **功能**:
  - 拖拽上传处理
  - 文件选择处理
  - 日志内容解析
  - 清空日志
  - 上次日志保存/加载
  - 快速打开上次日志

### 3. searchFilter.js - 搜索过滤模块
- **职责**: 搜索和过滤功能
- **功能**:
  - 关键词搜索（支持正则表达式）
  - 日志过滤（支持正则表达式）
  - 搜索结果导航
  - 清除搜索/过滤
  - 智能正则检测

### 4. configManager.js - 配置管理模块
- **职责**: 正则规则和配置组管理
- **功能**:
  - 正则规则增删改查
  - 配置组管理
  - 规则高亮配置
  - 配置组规则关联
  - 配置导入导出
  - 诊断规则管理

### 5. uiRenderer.js - UI渲染模块
- **职责**: 日志显示和样式处理
- **功能**:
  - 日志内容渲染
  - 正则高亮应用
  - 搜索高亮处理
  - 选中行样式更新
  - 配置组过滤应用
  - 分批渲染优化性能

### 6. contextMenu.js - 右键菜单模块
- **职责**: 上下文菜单处理
- **功能**:
  - 右键菜单显示/隐藏
  - 菜单操作处理
  - 添加到排查区
  - 复制日志行
  - 排查区菜单管理

### 7. investigation.js - 排查区模块
- **职责**: 排查日志管理
- **功能**:
  - 排查日志渲染
  - 清空排查区
  - 搜索高亮应用
  - 点击跳转原日志行

### 8. diagnosis.js - 问题诊断模块
- **职责**: 问题诊断规则管理和自动诊断
- **功能**:
  - 诊断规则管理
  - 自动问题诊断
  - 诊断结果统计
  - 诊断结果分组显示
  - 自定义脚本执行
  - 诊断结果导出

### 9. export.js - 导出模块
- **职责**: 日志导出功能
- **功能**:
  - 导出所有日志
  - 导出排查区日志
  - 导出诊断结果

### 10. resizer.js - 分隔条模块
- **职责**: 界面分隔条拖动功能
- **功能**:
  - 分隔条拖动
  - 区域大小调整
  - 位置持久化
  - 触摸屏支持

### 11. customDownloadManager.js - 自定义下载管理模块
- **职责**: 自定义下载源管理
- **功能**:
  - 扫描自定义下载源
  - 下载源可用性检查
  - 下载任务管理
  - 格式化日志添加

### 12. utils.js - 工具函数模块
- **职责**: 通用工具函数
- **功能**:
  - HTML转义
  - 行选择
  - 规则ID生成
  - 激活规则获取

## 调用方式变化

### 原始调用方式:
```javascript
// 在单个类中直接调用方法
this.showConfigPanel();
this.renderLogs();
```

### 模块化后调用方式:
```javascript
// 通过模块实例调用方法
new ConfigManager(this).showConfigPanel();
new UIRenderer(this).renderLogs();
```

## 兼容性保证

1. **接口兼容**: 所有公共方法保持相同的函数签名
2. **数据兼容**: 核心数据结构保持不变
3. **事件兼容**: 事件绑定方式保持不变
4. **存储兼容**: localStorage 存储格式保持不变

## 优势

1. **可维护性**: 每个模块职责单一，代码更清晰
2. **可测试性**: 模块可以独立测试
3. **可扩展性**: 新增功能只需添加新模块
4. **代码复用**: 通用功能可以跨模块复用

## 使用说明

1. 确保浏览器支持 ES6 模块
2. HTML 中引用 `main.js` 并添加 `type="module"`
3. 所有功能调用方式与之前完全一致
4. 配置数据会自动从 localStorage 加载

## 故障排除

如果遇到功能不正常：
1. 检查浏览器控制台错误信息
2. 确认所有模块文件都存在
3. 验证 ES6 模块支持